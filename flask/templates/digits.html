{% extends "layout.html" %}

{% block extrahead %}
    <script type="text/javascript" src="{{ url_for('static', filename='js/drawing.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/digits.css') }}">
{% endblock %}

{% block content %}
  <h1>Digit Recognizer</h1>
  <p> This project uses a Convolutional Neural Network programmed in Tensorflow to recognize a digit drawn in an HTML5 canvas.</p>
  <p> Give it a try by writing a numeral from 0-9, in the box below and click submit. </p>
  <p> Be patient as the first input will take a while as the machine learning server will need to spin up.</p>
  
  <div id="container">
    <canvas id="imageView" width="84" height="84" style="border: 1px solid #000">
      <p>Unfortunately, your browser isn't currently unsupported.</p>
    </canvas>
  </div>

  <button onclick="clearCanvas()">Erase</button>
  <button id="submitBtn" onclick="submitCanvas()">Submit</button>

  <p id="error" style="color:red"></p>

  <table id="topK">
    <tr>
      <td><b>Digit</b></td> <td><b>Probability</b></td>
    </tr>
    <tr><td>?</td> <td>?</td></tr>
  </table>

  <p> The model was trained on batches of 100 images for 20,000 iterations, resulting in a 97% accuracy. </p>
  <p> When I first testing this page, I found the accuracy was very poor. It was particulary bad at guessing 7 and 1. 
      My initial hunch was the input from canvas tool did not look close enough to the training data.
  </p>
  <p> I spent more time preprocessing the data to look like the inputs. 
    By centering cropping, adding white space around the digit and rescaling the image, before creating the 784 dimensional vector.</p>
  <p> For instance this is what the input looks like:</p>
  <img id="moded" src="" style="border-style: solid;border-width: 3px; border-color: red;"/> 

  <p> This is what the infrastructure for this project:</p>
  <img src="static/img/ml_diagram_color.png" width="420" height="180">
  <p> 1: The user draws a digit on the canvas element, which is sent to the Flask backend. </p>
  <p> 2: The backend processes the data turning it into a 784 dimensional vector, which is sent to the ML Engine instance for classification. </p>
  <p> 3: The prediction is returned to the user, who can verify the input </p>
  <p> 4: The verified input and the original unprocessed data are archived in a database </p>
  <p> 5: The ML engine can retrain using the new user labeled inputs to create an improved new model. </p>
{% endblock %}